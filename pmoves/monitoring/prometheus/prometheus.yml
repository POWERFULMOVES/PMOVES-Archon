global:
  scrape_interval: 15s
  evaluation_interval: 15s

# Alert rules configuration
rule_files:
  - "alert.rules.yml"

scrape_configs:
  - job_name: prometheus
    static_configs:
      - targets: ["prometheus:9090"]

  # DISABLED: Requires node_exporter installed on host
  # - job_name: node
  #   static_configs:
  #     - targets: ["host.docker.internal:9100"]

  - job_name: cadvisor
    static_configs:
      - targets: ["cadvisor:8080"]

  - job_name: loki
    static_configs:
      - targets: ["loki:3100"]

  # === Direct /metrics scraping ===
  # Services that expose Prometheus metrics endpoint

  - job_name: flute-gateway
    static_configs:
      - targets: ["flute-gateway:8055"]

  - job_name: tensorzero-gateway
    static_configs:
      - targets: ["tensorzero-gateway:3000"]

  - job_name: deepresearch-metrics
    static_configs:
      - targets: ["deepresearch:8098"]

  - job_name: supaserch-metrics
    static_configs:
      - targets: ["supaserch:8099"]

  - job_name: gpu-orchestrator
    static_configs:
      - targets: ["gpu-orchestrator:8200"]

  # === Tier 2 Services (Added 2025-12-24) ===

  - job_name: hi-rag-gateway-v2
    static_configs:
      - targets: ["hi-rag-gateway-v2:8086"]

  - job_name: extract-worker
    static_configs:
      - targets: ["extract-worker:8083"]

  - job_name: pmoves-yt
    static_configs:
      - targets: ["pmoves-yt:8077"]

  - job_name: agent-zero
    static_configs:
      - targets: ["agent-zero:8080"]

  - job_name: github-runner-ctl
    static_configs:
      - targets: ["github-runner-ctl:8100"]
      labels:
        service: "github-runner-ctl"
        tier: "orchestration"

  - job_name: archon
    static_configs:
      - targets: ["archon:8181"]

  # === Tier 3 Services (Added 2025-12-24) ===

  - job_name: jellyfin-bridge
    static_configs:
      - targets: ["jellyfin-bridge:8093"]

  - job_name: pdf-ingest
    static_configs:
      - targets: ["pdf-ingest:8092"]

  - job_name: notebook-sync
    static_configs:
      - targets: ["notebook-sync:8095"]

  - job_name: langextract
    static_configs:
      - targets: ["langextract:8084"]

  - job_name: presign
    static_configs:
      - targets: ["presign:8088"]

  # === Tier 4 Services (Added 2025-12-25) ===

  - job_name: render-webhook
    static_configs:
      - targets: ["render-webhook:8085"]

  - job_name: session-context-worker
    static_configs:
      - targets: ["session-context-worker:8100"]

  - job_name: messaging-gateway
    static_configs:
      - targets: ["messaging-gateway:8101"]

  # === Blackbox HTTP probes ===
  # Health check probes for services without /metrics

  - job_name: blackbox_http
    metrics_path: /probe
    params:
      module: [http_2xx]
    static_configs:
      - targets:
          - http://host.docker.internal:8080/healthz       # agent-zero
          - http://host.docker.internal:8086/              # hi-rag v2 CPU
          - http://host.docker.internal:8087/              # hi-rag v2 GPU
          - http://host.docker.internal:8088/healthz        # presign
          - http://host.docker.internal:8181/health         # archon
          - http://host.docker.internal:8097/healthz        # channel monitor
          - http://host.docker.internal:4000                # tensorzero playground
          - http://host.docker.internal:8055/healthz        # flute-gateway
    relabel_configs:
      - source_labels: [__address__]
        target_label: __param_target
      - source_labels: [__param_target]
        target_label: instance
      - target_label: __address__
        replacement: blackbox:9115

  # DISABLED: channel-monitor doesn't expose /metrics endpoint
  # - job_name: channel_monitor
  #   static_configs:
  #     - targets: ["channel-monitor:8097"]
