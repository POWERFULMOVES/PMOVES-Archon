global:
  scrape_interval: 15s
  evaluation_interval: 15s

scrape_configs:
  - job_name: prometheus
    static_configs:
      - targets: ["prometheus:9090"]

  # DISABLED: Requires node_exporter installed on host
  # - job_name: node
  #   static_configs:
  #     - targets: ["host.docker.internal:9100"]

  - job_name: cadvisor
    static_configs:
      - targets: ["cadvisor:8080"]

  - job_name: loki
    static_configs:
      - targets: ["loki:3100"]

  # === Direct /metrics scraping ===
  # Services that expose Prometheus metrics endpoint

  - job_name: flute-gateway
    static_configs:
      - targets: ["flute-gateway:8055"]

  # DISABLED: TensorZero gateway doesn't expose /metrics endpoint
  # Use ClickHouse metrics instead via TensorZero UI
  # - job_name: tensorzero-gateway
  #   static_configs:
  #     - targets: ["tensorzero-gateway:3000"]

  - job_name: deepresearch-metrics
    static_configs:
      - targets: ["deepresearch:8098"]

  - job_name: supaserch-metrics
    static_configs:
      - targets: ["supaserch:8099"]

  # === Blackbox HTTP probes ===
  # Health check probes for services without /metrics

  - job_name: blackbox_http
    metrics_path: /probe
    params:
      module: [http_2xx]
    static_configs:
      - targets:
          - http://host.docker.internal:8080/healthz        # agent-zero
          - http://host.docker.internal:8086/              # hi-rag v2 CPU
          - http://host.docker.internal:8087/              # hi-rag v2 GPU
          - http://host.docker.internal:8088/healthz        # presign
          - http://host.docker.internal:8091/healthz        # archon
          - http://host.docker.internal:8097/healthz        # channel monitor
          - http://host.docker.internal:4000                # tensorzero playground
          - http://host.docker.internal:8055/healthz        # flute-gateway
    relabel_configs:
      - source_labels: [__address__]
        target_label: __param_target
      - source_labels: [__param_target]
        target_label: instance
      - target_label: __address__
        replacement: blackbox:9115

  # DISABLED: channel-monitor doesn't expose /metrics endpoint
  # - job_name: channel_monitor
  #   static_configs:
  #     - targets: ["channel-monitor:8097"]
