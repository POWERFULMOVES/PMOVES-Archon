services:
  open-notebook:
    image: ${OPEN_NOTEBOOK_IMAGE:-ghcr.io/lfnovo/open-notebook:v1-latest}
    # Default to the Open Notebook fork; override OPEN_NOTEBOOK_IMAGE to pin your own tag.
    container_name: cataclysm-open-notebook
    restart: unless-stopped
    env_file:
      - env.shared.generated
      - env.shared
      - .env.generated
      - .env.local
    environment:
      # UI talks to API on localhost inside container.
      API_URL: http://localhost:5055
    ports:
      - "${OPEN_NOTEBOOK_UI_PORT:-8503}:8502"
      - "${OPEN_NOTEBOOK_API_PORT:-5055}:5055"
    volumes:
      - ./data/open-notebook/notebook_data:/app/data
    networks:
      cataclysm:
        aliases:
          - cataclysm-open-notebook
      pmoves:
        aliases:
          - cataclysm-open-notebook
          - open-notebook
      pmoves_api:
        aliases:
          - open-notebook
      pmoves_app:
        aliases:
          - open-notebook
networks:
  cataclysm:
    external: true
    name: cataclysm-net
  pmoves:
    external: true
    name: pmoves-net
  # Open Notebook uses TensorZero + Ollama for embeddings/LLM routing. Those services live on the tiered
  # Compose networks (pmoves_api / pmoves_app), not the shared pmoves-net bridge.
  pmoves_api:
    external: true
    name: pmoves_api
  pmoves_app:
    external: true
    name: pmoves_app
