version: "3.9"

services:
  wger:
    image: ${WGER_IMAGE:-ghcr.io/powerfulmoves/pmoves-health-wger:main}
    container_name: pmoves-wger
    restart: unless-stopped
    networks: [pmoves]
    environment:
      - DEBUG=false
    ports:
      - "8000:8000"

  firefly:
    image: ${FIREFLY_IMAGE:-fireflyiii/core:latest}
    container_name: pmoves-firefly
    restart: unless-stopped
    networks: [pmoves]
    environment:
      APP_KEY: ${FIREFLY_APP_KEY:-SomeRandomStringOf32CharsExactly}
      APP_ENV: ${FIREFLY_APP_ENV:-production}
      SITE_OWNER: ${FIREFLY_SITE_OWNER:-ops@pmoves.ai}
      DB_CONNECTION: ${FIREFLY_DB_CONNECTION:-sqlite}
      DB_DATABASE: ${FIREFLY_DB_DATABASE:-/var/www/html/storage/database/database.sqlite}
      TRUSTED_PROXIES: ${FIREFLY_TRUSTED_PROXIES:-**}
      TZ: ${FIREFLY_TZ:-America/New_York}
    ports:
      - "${FIREFLY_PORT:-8080}:8080"
    volumes:
      - firefly-storage:/var/www/html/storage

  open-notebook-surrealdb-ext:
    image: ${OPEN_NOTEBOOK_SURREAL_IMAGE:-surrealdb/surrealdb:v2}
    container_name: pmoves-open-notebook-surrealdb
    command: start --log info --user ${OPEN_NOTEBOOK_SURREAL_USER:-root} --pass ${OPEN_NOTEBOOK_SURREAL_PASS:-root} rocksdb:/mydata/mydatabase.db
    restart: unless-stopped
    user: "0:0"
    networks: [pmoves]
    volumes:
      - ./data/open-notebook/surreal_data:/mydata

  open-notebook-ext:
    image: ${OPEN_NOTEBOOK_IMAGE:-ghcr.io/powerfulmoves/pmoves-open-notebook:main}
    container_name: pmoves-open-notebook
    restart: unless-stopped
    depends_on:
      - open-notebook-surrealdb-ext
    networks: [pmoves]
    environment:
      SURREAL_ADDRESS: ${OPEN_NOTEBOOK_SURREAL_ADDRESS:-pmoves-open-notebook-surrealdb}
      SURREAL_PORT: ${OPEN_NOTEBOOK_SURREAL_PORT:-8000}
      SURREAL_USER: ${OPEN_NOTEBOOK_SURREAL_USER:-root}
      SURREAL_PASS: ${OPEN_NOTEBOOK_SURREAL_PASS:-root}
      SURREAL_NAMESPACE: ${OPEN_NOTEBOOK_SURREAL_NAMESPACE:-open-notebook}
      SURREAL_DATABASE: ${OPEN_NOTEBOOK_SURREAL_DATABASE:-open-notebook}
      OPEN_NOTEBOOK_API_TOKEN: ${OPEN_NOTEBOOK_API_TOKEN:-}
      OPEN_NOTEBOOK_PASSWORD: ${OPEN_NOTEBOOK_PASSWORD:-}
    ports:
      - "${OPEN_NOTEBOOK_UI_PORT:-8503}:8502"    # UI
      - "${OPEN_NOTEBOOK_API_PORT:-5055}:5055"  # API
    volumes:
      - ./data/open-notebook/notebook_data:/app/data

  jellyfin-ext:
    image: ${JELLYFIN_IMAGE:-jellyfin/jellyfin:latest}
    container_name: pmoves-jellyfin
    restart: unless-stopped
    networks: [pmoves]
    ports:
      - "8096:8096"

networks:
  pmoves:
    external: true
    name: pmoves-net

volumes:
  firefly-storage:
